# ê°„ì´ ì›¹í˜ì´ì§€ ë³€ê²½ ëª¨ë‹ˆí„°

ë¡œê·¸ì¸ í˜ì´ì§€ì˜ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ê°„ì´ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. ë‚´ìš© ê¸°ë°˜ ë³€ê²½ ê°ì§€

### 3. ë°ì´í„° ì €ì¥
- SQLite ë°ì´í„°ë² ì´ìŠ¤ì— ìŠ¤ëƒ…ìƒ· ì €ì¥
- CSV ë³´ê³ ì„œ ìƒì„±
- ìƒì„¸í•œ ë¡œê·¸ ê¸°ë¡

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
simple-web-page-monitor-module/
â”œâ”€â”€ monitor.py              # ë©”ì¸ ëª¨ë‹ˆí„°ë§ ë¡œì§
â”œâ”€â”€ simple_compare.py       # HTML ë¹„êµ ë° ì•…ì˜ì  ë³€ê²½ ê°ì§€
â”œâ”€â”€ fetcher.py             # ì›¹í˜ì´ì§€ ê°€ì ¸ì˜¤ê¸°
â”œâ”€â”€ database.py            # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬
â”œâ”€â”€ csv_report.py          # CSV ë³´ê³ ì„œ ìƒì„±
â”œâ”€â”€ logger.py              # ë¡œê¹… ì„¤ì •
â”œâ”€â”€ config.py              # ìš´ì˜ìš© ì„¤ì • íŒŒì¼
â”œâ”€â”€ config_prod.py         # í”„ë¡œë•ì…˜ ì„¤ì • ë°±ì—…
â”œâ”€â”€ config_test.py         # í…ŒìŠ¤íŠ¸ìš© ì„¤ì • íŒŒì¼
â”œâ”€â”€ simple_test.py         # â­ ë³€ì¡° ê°ì§€ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ README.md              # ì´ íŒŒì¼
```

## ğŸ› ï¸ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
pip install requests beautifulsoup4
```

### 2. ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ì‹¤í–‰
```bash
python monitor.py
```

### 3. ë³€ì¡° ê°ì§€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ 
```bash
# ë³€ì¡° ê°ì§€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
python simple_test.py
```

**âš ï¸ ì¤‘ìš”: ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë°˜ë“œì‹œ ìœ„ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤!**

## ğŸ§ª ë³€ì¡° ê°ì§€ í…ŒìŠ¤íŠ¸

### â­ simple_test.py ì‹¤í–‰
```bash
# ë³€ì¡° ê°ì§€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
python simple_test.py
```

`simple_test.py`ëŠ” ë³€ì¡° ê°ì§€ ì‹œìŠ¤í…œì„ ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤:

**ğŸ” ë™ì‘ ê³¼ì •:**
1. êµë³´ë¬¸ê³  ë¡œê·¸ì¸ í˜ì´ì§€ ì›ë³¸ ë‹¤ìš´ë¡œë“œ
2. 3ê°€ì§€ ë³€ì¡° ë²„ì „ ìë™ ìƒì„± (URL ë³€ì¡°, ì•…ì„± ìŠ¤í¬ë¦½íŠ¸, í…ìŠ¤íŠ¸ ë³€ì¡°)
3. ë¡œì»¬ HTTP ì„œë²„ ìë™ ì‹œì‘
4. ë³€ì¡° ê°ì§€ ë¡œì§ í…ŒìŠ¤íŠ¸ ë° ê²°ê³¼ ì¶œë ¥
5. ìƒì„¸í•œ ë¡œê·¸ íŒŒì¼ ìƒì„± (`simple_test.log`)

**ğŸ“Š í•µì‹¬ ì½”ë“œ ì„¤ëª…:**
```python
# í•´ì‹œ ê³„ì‚°ìœ¼ë¡œ ë³€ê²½ ê°ì§€
original_hash = hashlib.sha256(original_html.encode('utf-8')).hexdigest()
modified_hash = hashlib.sha256(modified_html.encode('utf-8')).hexdigest()

# ë³€ì¡° ê°ì§€ ë¡œì§ ì‹¤í–‰
changed = is_html_changed(original_html, modified_html)

# ê²°ê³¼ ë¡œê¹…
log_message = f"[ë³€ì¡°ìœ í˜•] ì›ë³¸í•´ì‹œ: {original_hash[:16]}..., ë³€ì¡°í•´ì‹œ: {modified_hash[:16]}..., ê°ì§€ê²°ê³¼: {changed}"
```

### ğŸ“ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ìƒì„±ë˜ëŠ” íŒŒì¼ë“¤:
- `kyobo_login_original.html`: ì›ë³¸ êµë³´ë¬¸ê³  ë¡œê·¸ì¸ í˜ì´ì§€
- `kyobo_login_url_modified.html`: URL ë³€ì¡° ë²„ì „
- `kyobo_login_script_modified.html`: ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ ë²„ì „  
- `kyobo_login_text_modified.html`: í…ìŠ¤íŠ¸ ë³€ì¡° ë²„ì „
- `simple_test.log`: ìƒì„¸í•œ í…ŒìŠ¤íŠ¸ ë¡œê·¸

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **URL ë³€ì¡°**: êµë³´ë¬¸ê³  URLì„ ì•…ì˜ì  ì‚¬ì´íŠ¸ë¡œ ë³€ê²½
2. **ì•…ì„± ìŠ¤í¬ë¦½íŠ¸**: í‚¤ë¡œê±° ë“± ì•…ì„± JavaScript ì½”ë“œ ì‚½ì…
3. **í…ìŠ¤íŠ¸ ë³€ì¡°**: "êµë³´ë¬¸ê³ " â†’ "ê°€ì§œë¬¸ê³ " ë“± í…ìŠ¤íŠ¸ ë³€ê²½

## ğŸ“Š ê²°ê³¼ í™•ì¸

### ìš´ì˜ìš© íŒŒì¼ë“¤
- `monitor.log`: ìƒì„¸í•œ ëª¨ë‹ˆí„°ë§ ë¡œê·¸
- `snapshots_monitor.db`: SQLite ë°ì´í„°ë² ì´ìŠ¤
- `monitoring_report_simple.csv`: ìš”ì•½ ë³´ê³ ì„œ

### í…ŒìŠ¤íŠ¸ìš© íŒŒì¼ë“¤
- `simple_test.log`: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸
- `kyobo_login_*.html`: í…ŒìŠ¤íŠ¸ìš© HTML íŒŒì¼ë“¤

### ë°ì´í„°ë² ì´ìŠ¤
- ìŠ¤ëƒ…ìƒ· í…Œì´ë¸”: íƒ€ì„ìŠ¤íƒ¬í”„, URL, í•´ì‹œ, HTML ë‚´ìš©, ë³€ê²½ ì—¬ë¶€

### CSV ë³´ê³ ì„œ
- ì»¬ëŸ¼: ë‚ ì§œ, ì‹œê°„, URL, ë³€ê²½ê°ì§€, ë³€ê²½ë‚´ìš©, HTMLí¬ê¸°, í•´ì‹œê°’

## ğŸ”§ ì„¤ì •

### config.py (ìš´ì˜ìš©)
```python
TARGET_URL = "https://mmbr.kyobobook.co.kr/login"  # ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ
LOG_FILE = "monitor.log"                            # ë¡œê·¸ íŒŒì¼
DATABASE_PATH = "snapshots_monitor.db"              # ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼
CSV_REPORT_SIMPLE = "monitoring_report_simple.csv"  # CSV ë³´ê³ ì„œ
```


## ğŸ“ˆ ì„±ëŠ¥ ë° ì•ˆì •ì„±

### ë„¤íŠ¸ì›Œí¬ ì•ˆì •ì„±
- 30ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
- User-Agent í—¤ë” ì„¤ì •
- 10MB HTML í¬ê¸° ì œí•œ

### ì—ëŸ¬ ì²˜ë¦¬
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
- HTML íŒŒì‹± ì˜¤ë¥˜ ì²˜ë¦¬
- ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜ ì²˜ë¦¬

## ğŸ” ëª¨ë‹ˆí„°ë§ ê²°ê³¼ ì˜ˆì‹œ

```
2024-01-15 10:30:15 - INFO - [ë‚´ìš© ê¸°ë°˜ ëª¨ë“œ] ì‹¤ì œ HTML ë‚´ìš©ê³¼ ì•…ì˜ì  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëª¨ë‘ ê°ì§€í•©ë‹ˆë‹¤.
2024-01-15 10:30:16 - WARNING - [ë‚´ìš© ê¸°ë°˜ ëª¨ë“œ] ë‚´ìš© ë³€ê²½: ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€, ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë‚´ìš©
2024-01-15 10:30:16 - INFO - ëª¨ë‹ˆí„°ë§ ì™„ë£Œ
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **BeautifulSoup ì˜ì¡´ì„±**: `beautifulsoup4` íŒ¨í‚¤ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤
2. **í…ŒìŠ¤íŠ¸ í™˜ê²½**: ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œ í¬íŠ¸ 8000ì´ ì‚¬ìš©ë©ë‹ˆë‹¤
3. **ë°ì´í„° ë°±ì—…**: ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ë³„ë„ë¡œ ë°±ì—…í•˜ì„¸ìš”
4. **ë„¤íŠ¸ì›Œí¬**: ì•ˆì •ì ì¸ ì¸í„°ë„· ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤
5. **í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¶„ë¦¬**: í…ŒìŠ¤íŠ¸ìš© íŒŒì¼ë“¤ì€ ìš´ì˜ìš©ê³¼ ì™„ì „íˆ ë¶„ë¦¬ë©ë‹ˆë‹¤

## ğŸš¨ ì•Œë ¤ì§„ ì œí•œì‚¬í•­

### ë™ì  CSS í•´ì‹œ ë¬¸ì œ
í˜„ì¬ ì‹œìŠ¤í…œì€ **ë‹¨ìˆœ SHA256 í•´ì‹œ ë¹„êµ**ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë¬´ì˜ë¯¸í•œ ë³€ê²½ë„ ê°ì§€í•©ë‹ˆë‹¤:

- **ë™ì  CSS íŒŒì¼ í•´ì‹œ**: `styles-abc123.css` â†’ `styles-def456.css`
- **íƒ€ì„ìŠ¤íƒ¬í”„ ë³€ê²½**: í˜ì´ì§€ ë¡œë“œ ì‹œê°„, ì„¸ì…˜ ì‹œê°„ ë“±
- **ì„¸ì…˜ í† í°**: CSRF í† í°, ì„¸ì…˜ ID ë“± ë™ì  ê°’
- **ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸**: Google Analytics, ê´‘ê³  íƒœê·¸ ë“±

### âœ… í˜„ì¬ êµ¬í˜„ ìƒíƒœ
```python
# simple_compare.py - í˜„ì¬ êµ¬í˜„ (ë™ì  í•„í„°ë§ í¬í•¨)
def is_html_exactly_equal_filtered(html1: str, html2: str) -> bool:
    """ë™ì  ìš”ì†Œë¥¼ í•„í„°ë§í•œ í›„ HTML ë¹„êµ"""
    normalized_html1 = normalize_dynamic_content(html1)
    normalized_html2 = normalize_dynamic_content(html2)
    return normalized_html1 == normalized_html2

def normalize_dynamic_content(html: str) -> str:
    """ë™ì  ìš”ì†Œ ì •ê·œí™”"""
    # CSS/JS íƒ€ì„ìŠ¤íƒ¬í”„ ì œê±° (?t=ìˆ«ì)
    html = re.sub(r'\?t=\d+', '', html)
    # JavaScript ì„¸ì…˜ í† í° ì •ê·œí™”
    html = re.sub(r'(NfVTe|sXDdA|qPSFs|Tywgp)":"[^"]*"', r'\1":"NORMALIZED"', html)
    # ë¡œê·¸ íƒ€ì„ìŠ¤íƒ¬í”„ ì •ê·œí™”
    html = re.sub(r'\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}', 'YYYY-MM-DD HH:MM:SS', html)
    return html
```

### ğŸ“Š ê°œì„ ëœ ëª¨ë‹ˆí„°ë§ ê²°ê³¼
```
2025-01-14 - INFO - ë³€ê²½ ì—†ìŒ (ë™ì  ìš”ì†Œë§Œ ë³€ê²½ë¨)  # ì´ì „: ë§¤ë²ˆ ë³€ê²½ ê°ì§€
2025-01-14 - WARNING - ì•…ì˜ì  ë³€ì¡° ê°ì§€!           # ì‹¤ì œ ìœ„í—˜í•œ ë³€ê²½ë§Œ ê°ì§€
```

## ğŸ†˜ ë¬¸ì œ í•´ê²°

### BeautifulSoup ì„¤ì¹˜ ì˜¤ë¥˜
```bash
pip install beautifulsoup4 lxml
```

### í¬íŠ¸ ì¶©ëŒ
```bash
# ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
python -m http.server 8080
```

### ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜
```bash
# ìš´ì˜ìš© ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ì‚­ì œ í›„ ì¬ìƒì„±
rm snapshots_monitor.db
python monitor.py
```

### í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ
```bash
# í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤ ì •ë¦¬ í›„ ì¬ì‹œë„
rm -rf test_pages test_*.db test_*.log test_*.csv
python test_detection_logic.py
```

### í…ŒìŠ¤íŠ¸ íŒŒì¼ ì •ë¦¬
```bash
# í…ŒìŠ¤íŠ¸ìš© íŒŒì¼ë“¤ë§Œ ì‚­ì œ
rm -f test_*.db test_*.log test_*.csv
rm -rf test_pages
```
